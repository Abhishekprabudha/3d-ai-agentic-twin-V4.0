<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agentic Twin â€” Staged Disruptions</title>
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    :root{
      --bg:#0a0a0b;
      --panel:#ffffff;
      --panelText:#0e1116;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow:0 8px 24px rgba(0,0,0,.25);
      --chatW: 360px; /* left chat width */
    }
    html, body { height: 100%; margin: 0; background: var(--bg); }
    #app { position: relative; width: 100%; height: 100%; display: flex; }

    /* Left chat dock */
    #chat {
      width: var(--chatW);
      min-width: 280px;
      max-width: 420px;
      height: 100%;
      box-sizing: border-box;
      padding: 12px;
      background: transparent; /* panel sits inside */
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #chatPanel{
      background: var(--panel);
      color: var(--panelText);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }
    #chatHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 12px; border-bottom:1px solid var(--border);
    }
    #chatHeader h3{ margin:0; font:600 14px/1.2 system-ui, Segoe UI, Roboto, sans-serif; letter-spacing:.2px; }
    #chatHeader .actions{ display:flex; gap:8px; }
    .iconbtn{
      border:1px solid var(--border); background:#f8fafc; color:#111827;
      padding:6px 8px; border-radius:10px; cursor:pointer; font: 13px/1 system-ui;
    }
    .iconbtn:hover{ background:#f3f4f6; }

    #msgs{
      flex:1; overflow:auto; padding: 12px; display:flex; flex-direction:column; gap:8px;
      scroll-behavior: smooth;
    }
    .msg{
      max-width: 90%;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 10px;
      font: 13px/1.35 system-ui, Segoe UI, Roboto, sans-serif;
      box-shadow: 0 1px 0 rgba(0,0,0,.04);
    }
    .msg.system{ background:#f8fafc; }
    .msg.user{ background:#eef6ff; border-color:#dbeafe; }
    .msg small{ display:block; color: var(--muted); margin-top:4px; font-size:11px; }

    #composer{
      display:flex; gap:8px; padding: 10px; border-top:1px solid var(--border);
      background:#fff;
    }
    #chatInput{
      flex:1; border:1px solid var(--border); border-radius:10px; padding:10px 12px;
      font: 13px/1.2 system-ui; outline:none;
    }
    #chatSend{
      border:1px solid var(--border); background:#111318; color:#e6e6e6;
      padding:10px 12px; border-radius:10px; cursor:pointer; font:13px/1 system-ui;
    }
    #chatSend:hover{ background:#191b22; }

    /* Map + HUD area */
    #stage{ position: relative; flex:1; height: 100%; }
    #map { position:absolute; inset:0; }

    /* Top-left UI buttons (kept) */
    #ui {
      position: fixed; top: 12px; left: calc(var(--chatW) + 12px); display: flex; gap: 8px; z-index: 10;
    }
    #ui button {
      background: #111318; color: #e6e6e6; border: 1px solid #2a2a2a;
      padding: 8px 12px; border-radius: 10px; cursor: pointer; font: 14px/1.2 system-ui, Segoe UI, Roboto, sans-serif;
    }
    #ui button:hover { background: #191b22; }

    /* Warehouse stats card */
    #stats {
      position: fixed; right: 12px; top: 12px; width: 300px; z-index: 10;
      background: rgba(11,11,13,0.9); color: #e6e6e6; border: 1px solid #2a2a2a;
      border-radius: 12px; padding: 12px; font: 13px/1.35 system-ui, Segoe UI, Roboto, sans-serif;
      backdrop-filter: blur(4px);
    }
    #stats h3 { margin: 0 0 8px 0; font-size: 14px; }
    #stats table { width: 100%; border-collapse: collapse; }
    #stats th, #stats td { padding: 6px 4px; border-bottom: 1px solid #24262c; font-size: 12px; }
    #stats th { color: #aab3bd; text-align: left; font-weight: 600; }
    #stats .pos { color: #00d08a; }
    #stats .neg { color: #ff6b6b; }

    @media (max-width: 980px){
      :root{ --chatW: 300px; }
    }
    @media (max-width: 820px){
      /* Stack chat above map if too narrow */
      #app{ flex-direction: column; }
      #chat{ width: 100%; height: 40%; max-height: 46%; }
      #ui{ left: 12px; }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Left chat dock -->
    <aside id="chat">
      <div id="chatPanel" role="region" aria-label="Narration panel">
        <div id="chatHeader">
          <h3>Narration</h3>
          <div class="actions">
            <button id="muteBtn" class="iconbtn" aria-pressed="false" aria-label="Mute narration">ðŸ”Š Mute</button>
            <button id="clearBtn" class="iconbtn" aria-label="Clear messages">Clear</button>
          </div>
        </div>
        <div id="msgs" role="log" aria-live="polite" aria-relevant="additions"></div>
        <div id="composer">
          <input id="chatInput" type="text" placeholder="Type: Disrupt / Correct / Normal" autocomplete="off" />
          <button id="chatSend">Send</button>
        </div>
      </div>
    </aside>

    <!-- Map stage -->
    <main id="stage">
      <div id="ui">
        <!-- script.js will relabel these and add 'Normal' -->
        <button id="btnBefore">Before Disruption</button>
        <button id="btnAfter">After Correction</button>
      </div>

      <div id="stats">
        <h3>Predicted Dashboard Status</h3>
        <table id="statsTable">
          <thead>
            <tr><th>Warehouse</th><th>Inv</th><th>In</th><th>Out</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="map"></div>
    </main>
  </div>

  <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
  <script src="script.js"></script>
</body>
</html>
